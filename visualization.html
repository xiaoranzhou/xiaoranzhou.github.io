<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Plotly.js -->
  <script type="text/javascript" charset="UTF-8"  src="plotly.js"></script>
  	<script src='https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js'></script>
</head>

<body>
	<div style="">
	
	<button onclick="plot();"> plot </button>
	</div>
  <div id="myDiv" style="width:95vw; height:95vh"><!-- Plotly chart will be drawn inside this DIV --></div>
  
  <script>
  function plot(name){
  

d3.csv(name, function(err, rows){
function unpack(rows, key) {
	return rows.map(function(row)
	{ return row[key]; });}

var trace1 = {
	
	x:unpack(rows, 'coor_x'), 
	y: unpack(rows, 'coor_y'), 
	z: unpack(rows, 'coor_z'),
	name: "Sieve-tube pressue",
	time: unpack(rows, 'time'),
	text: unpack(rows, 'P_ST'),
	customdata: unpack(rows, 'id'),
	hovertemplate: '<i>X</i>: %{x:.2f}' +
                        '<br><b>y</b>: %{y:.2f}' +
                        '<br><b>z</b>: %{z:.2f}' +
                        '<br><b>Sieve-tube pressure</b>:%{text:.2f} MPa</b>'+
						'<br><b>id</b>: %{customdata:.1f}<br>'+
						'<br><b>radius</b>: %{marker.size:.0f} mm<br>',
	mode: 'markers',
	marker: {
		size: unpack(rows, 'radius').map(function(radius)
	{ return radius*100; }),
	line: {
      color: 'rgb(231, 99, 250)',
      width: 0
    },
		opacity: 0.8,
		color: unpack(rows, 'P_ST'),
		coloraxis: 'coloraxis',
	
    showscale: false,
	
		
		},
	transforms: [{
    type: 'filter',
    target: unpack(rows, 'time'),
    operation: '=',
    value: 1
  }],
	
		scene: "scene1",
	type: 'scatter3d'
};

var trace2 = {
	x:unpack(rows, 'coor_x'), 
	y: unpack(rows, 'coor_y'), 
	z: unpack(rows, 'coor_z'),
	name:"Xylem pressure",
	time: unpack(rows, 'time'),
	text: unpack(rows, 'P_Xyl'),
	customdata: unpack(rows, 'id'),
	hovertemplate: '<i>X</i>: %{x:.2f}' +
                        '<br><b>y</b>: %{y:.2f}' +
                        '<br><b>z</b>: %{z:.2f}' +
                        '<br><b>Sieve-tube pressure</b>:%{text:.2f} MPa</b>'+
						'<br><b>id</b>: %{customdata:.0f}' +
						'<br><b>radius</b>: %{marker.size:.0f} mm<br>',
	mode: 'markers',
	marker: {
		size: unpack(rows, 'radius').map(function(radius)
	{ return radius*100; }),
	line: {
      color: 'rgb(231, 99, 250)',
      width: 0
    },
		opacity: 0.8,
		color: unpack(rows, 'P_Xyl'),
		coloraxis: 'coloraxis2',
	
    showscale: false,
	
		
		},
	transforms: [{
    type: 'filter',
    target: unpack(rows, 'time'),
    operation: '=',
    value: 1
  }],
	
	scene: "scene2",
	type: 'scatter3d'
};

var trace3 = {
	x:unpack(rows, 'coor_x'), 
	y: unpack(rows, 'coor_y'), 
	z: unpack(rows, 'coor_z'),
	name:"Carbon content",
	time: unpack(rows, 'time'),
	text: unpack(rows, 'Q_ST'),
	customdata: unpack(rows, 'id'),
	hovertemplate: '<i>X</i>: %{x:.2f}' +
                        '<br><b>y</b>: %{y:.2f}' +
                        '<br><b>z</b>: %{z:.2f}' +
                        '<br><b>Sieve-tube pressure</b>:%{text:.2f} mmol</b>'+
						'<br><b>id</b>: %{customdata:.0f}' +
						'<br><b>radius</b>: %{marker.size:.0f} mm<br>',
	mode: 'markers',
	marker: {
		size: unpack(rows, 'radius').map(function(radius)
	{ return radius*100; }),
	line: {
      color: 'rgb(231, 99, 250)',
      width: 0
    },
		opacity: 0.8,
		color: unpack(rows, 'Q_ST'),
		coloraxis: 'coloraxis3',
	
    showscale: false,
	
		
		},
	transforms: [{
    type: 'filter',
    target: unpack(rows, 'time'),
    operation: '=',
    value: 1
  }],
	
	scene: "scene3",
	type: 'scatter3d'
};

var trace4 = {
	x:unpack(rows, 'coor_x'), 
	y: unpack(rows, 'coor_y'), 
	z: unpack(rows, 'coor_z'),
	name:"Growth rate",
	time: unpack(rows, 'time'),
	text: unpack(rows, 'growth_rate'),
	customdata: unpack(rows, 'id'),
	hovertemplate: '<i>X</i>: %{x:.2f}' +
                        '<br><b>y</b>: %{y:.2f}' +
                        '<br><b>z</b>: %{z:.2f}' +
                        '<br><b>growth reate</b>:%{text:.2f} cm/day</b>'+
						'<br><b>id</b>: %{customdata:.0f}' +
						'<br><b>radius</b>: %{marker.size:.0f} mm<br>',
	mode: 'markers',
	marker: {
		size: unpack(rows, 'radius').map(function(radius)
	{ return radius*100; }),
	line: {
      color: 'rgb(231, 99, 250)',
      width: 0
    },
		opacity: 0.8,
		color: unpack(rows, 'growth_rate'),
		coloraxis: 'coloraxis4',
	
    showscale: false,
	
		
		},
	transforms: [{
    type: 'filter',
    target: unpack(rows, 'time'),
    operation: '=',
    value: 1
  }],
	
	scene: "scene4",
	type: 'scatter3d'
};
var layout= {
	margin:{t: 0},
	autosize: true,
	//width: 1600,
	//height: 800,
	coloraxis: {
	colorbar:{
		x:0.41,
		y:0.8,
		xanchor :"left",
		yanchor :"botton",
		len:0.4,
		thickness:10,
		},
    colorscale: 'Hot',
    showscale: true,

  },
	coloraxis2: {
	colorbar:{
		x:0.91,
		y:0.8,
		xanchor :"left",
		yanchor :"botton",
		len:0.4,
		thickness:10,
		},
    colorscale: 'Hot',
    showscale: true,

  },coloraxis3: {
	colorbar:{
		x:0.41,
		y:0.2,
		xanchor :"left",
		yanchor :"botton",
		len:0.4,
		thickness:10,
		},
    colorscale: 'Hot',
    showscale: true,

  },coloraxis4: {
	colorbar:{
		x:0.91,
		y:0.2,
		xanchor :"left",
		yanchor :"botton",
		len:0.4,
		thickness:10,
		},
    colorscale: 'Hot',
    showscale: true,

  },
	scene1:{
	aspectratio:{x:1,y:1,z:1},
	xaxis:{showticklabels:false, title:{text:""},range:[-0.1,0.1], gridcolor:"grey", color:"grey" ,backgroundcolor:"rgba(0, 0, 0, 0.2)",showbackground: true, },
	yaxis:{showticklabels:false, title:{text:""},range:[-0.1,0.1],  gridcolor:"black", color:"grey" ,backgroundcolor:"rgba(0, 0, 0, 0.2)",showbackground: true,},
	zaxis:{showticklabels:false, title:{text:""},range:[-0.18,0.18],  gridcolor:"black", color:"grey" ,backgroundcolor:"rgba(0, 0, 0, 0.2)",showbackground: true,},
	domain: {
            x: [0.0,  0.5],
            y: [0.5, 1.0]
        },
	camera: {
	center: {x:0,y:0,z:0},
	eye:{x:1,y:1,z:-0.2},
	up:{x:0,y:0,z:1},

	
	
	}
	
	
	},
	scene2:{
	aspectratio:{x:1,y:1,z:1},
	xaxis:{showticklabels:false, title:{text:""},range:[-0.1,0.1], gridcolor:"grey", color:"grey" ,backgroundcolor:"rgba(0, 0, 0, 0.2)",showbackground: true, },
	yaxis:{showticklabels:false, title:{text:""},range:[-0.1,0.1],  gridcolor:"black", color:"grey" ,backgroundcolor:"rgba(0, 0, 0, 0.2)",showbackground: true,},
	zaxis:{showticklabels:false, title:{text:""},range:[-0.18,0.18],  gridcolor:"black", color:"grey" ,backgroundcolor:"rgba(0, 0, 0, 0.2)",showbackground: true,},

	domain: {
            x: [0.5,  1.0],
            y: [0.5, 1.0]
        },
	camera: {
	center: {x:0,y:0,z:0},
	eye:{x:1,y:1,z:-0.2},
	up:{x:0,y:0,z:1}
	}
	
	
	},
	scene3:{
	aspectratio:{x:1,y:1,z:1},
	xaxis:{showticklabels:false, title:{text:""},range:[-0.1,0.1], gridcolor:"grey", color:"grey" ,backgroundcolor:"rgba(0, 0, 0, 0.2)",showbackground: true, },
	yaxis:{showticklabels:false, title:{text:""},range:[-0.1,0.1],  gridcolor:"black", color:"grey" ,backgroundcolor:"rgba(0, 0, 0, 0.2)",showbackground: true,},
	zaxis:{showticklabels:false, title:{text:""},range:[-0.18,0.18],  gridcolor:"black", color:"grey" ,backgroundcolor:"rgba(0, 0, 0, 0.2)",showbackground: true,},

	domain: {
            x: [0,  0.5],
            y: [ 0,   0.5]
        },
	camera: {
	center: {x:0,y:0,z:0},
	eye:{x:1,y:1,z:-0.2},
	up:{x:0,y:0,z:1}
	}
	
	
	},
	scene4:{
	aspectratio:{x:1,y:1,z:1},
	xaxis:{showticklabels:false, title:{text:""},range:[-0.1,0.1], gridcolor:"grey", color:"grey" ,backgroundcolor:"rgba(0, 0, 0, 0.2)",showbackground: true, },
	yaxis:{showticklabels:false, title:{text:""},range:[-0.1,0.1],  gridcolor:"black", color:"grey" ,backgroundcolor:"rgba(0, 0, 0, 0.2)",showbackground: true,},
	zaxis:{showticklabels:false, title:{text:""},range:[-0.18,0.18],  gridcolor:"black", color:"grey" ,backgroundcolor:"rgba(0, 0, 0, 0.2)",showbackground: true,},

	domain: {
            x: [0.5,  1.0],
            y: [ 0,   0.5]
        },
	camera: {
	center: {x:0,y:0,z:0},
	eye:{x:1,y:1,z:-0.2},
	up:{x:0,y:0,z:1}
	}
	
	
	},
	
    sliders: [{
      pad: {t: 30},
      x: 0.05,
      len: 0.95,
      currentvalue: {
        xanchor: 'right',
        prefix: 'day: ',
        font: {
          color: '#888',
          size: 20
        }
      },
      transition: {duration: 500},
     
      steps: []
    }],
    updatemenus: [{
      type: 'buttons',
      showactive: false,
      x: 0.05,
      y: 0,
      xanchor: 'right',
      yanchor: 'top',
      pad: {t: 60, r: 20},
      buttons: [{
        label: 'Play',
        method: 'animate',
        args: [null, {
          fromcurrent: true,
          frame: {redraw: true, duration: 1000},
          transition: {duration: 500}
        }]
      }]
    }]
  };
  

  
var frames = [];
  
  
    for (let i= 1 ;  i<16; i++ ){
	
	var step = {
        label: i.toString(),
        method: 'animate',
        args: [[i.toString()], {
          mode: 'immediate',
          frame: {redraw: true, duration: 500},
          transition: {duration: 500}
        }]
       };
	
	layout['sliders'][0]["steps"].push(step);
	
	var frame = {
	
    name: i.toString(),
    data: [{x:unpack(rows, 'coor_x'), 
	y: unpack(rows, 'coor_y'), 
	z: unpack(rows, 'coor_z'),
	transforms: [{
    type: 'filter',
    target: unpack(rows, 'time'),
    operation: '=',
    value: i
  }]}, {x:unpack(rows, 'coor_x'), 
	y: unpack(rows, 'coor_y'), 
	z: unpack(rows, 'coor_z'),
	transforms: [{
    type: 'filter',
    target: unpack(rows, 'time'),
    operation: '=',
    value: i
  }]}, {x:unpack(rows, 'coor_x'), 
	y: unpack(rows, 'coor_y'), 
	z: unpack(rows, 'coor_z'),
	transforms: [{
    type: 'filter',
    target: unpack(rows, 'time'),
    operation: '=',
    value: i
  }]}, {x:unpack(rows, 'coor_x'), 
	y: unpack(rows, 'coor_y'), 
	z: unpack(rows, 'coor_z'),
	transforms: [{
    type: 'filter',
    target: unpack(rows, 'time'),
    operation: '=',
    value: i
  }]}]
	
	};
	
	frames.push(frame);


}
var data = [trace1,trace2,trace3,trace4];
Plotly.newPlot('myDiv', {
    data: data,
    layout: layout,
    frames: frames,
  });
});
  };
  plot("https://raw.githubusercontent.com/xiaoranzhou/cpb-binder/master/tutorial/jupyter/case_01_0.075cm_lateral_radius.xml_16_1_0.1_0_res_2nd_10_trans_trsv6vml_15-6-29-15-36.csv");
  </script>
</body>
</html>